#!/usr/bin/env python3
"""
Script to remove cut-in related content from ActionSummary-predict_explain-fsl-sys-En-cutin-time-paper-batch.py
Focus solely on ghost probing detection to avoid confusion and interference
"""

import re

def remove_cut_in_content():
    input_file = "/Users/wanmeng/repository/GPT4Video-cobra-auto/VIP/ActionSummary-predict_explain-fsl-sys-En-cutin-time-paper-batch.py"
    output_file = "/Users/wanmeng/repository/GPT4Video-cobra-auto/VIP/ActionSummary-predict_explain-fsl-sys-En-cutin-time-paper-batch-GHOST_ONLY.py"
    
    with open(input_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # ä¿®æ”¹Task 1æ ‡é¢˜ï¼Œå»é™¤Cut-inæåŠ
    content = content.replace(
        '**Task 1: Identify and Predict potential "Ghost Probing(ä¸“ä¸šæœ¯è¯­ï¼šé¬¼æ¢å¤´)",Cut-in(åŠ å¡) etc behavior**',
        '**Task 1: Identify and Predict potential "Ghost Probing(ä¸“ä¸šæœ¯è¯­ï¼šé¬¼æ¢å¤´)" behavior**'
    )
    
    # å»é™¤Cut-inçš„æ•´ä¸ªå®šä¹‰æ®µè½ï¼ˆä»"2) Cut-In(åŠ å¡):"åˆ°"***Key Note***"è¡Œç»“æŸï¼‰
    cut_in_section_pattern = r'2\) Cut-In\(åŠ å¡\):.*?Vehicles entering from a perpendicular road or from behind physical obstructions should never be labeled as "cut-in"\. These must be classified as "ghost probing" if they create a dangerous situation with minimal reaction time\.'
    content = re.sub(cut_in_section_pattern, '', content, flags=re.DOTALL)
    
    # ç®€åŒ–noteå†…å®¹ï¼Œå»é™¤cut-inç›¸å…³è¯´æ˜
    content = content.replace(
        'Note: Only those emerging from behind a physical obstruction can be considered as é¬¼æ¢å¤´. Cut-inåŠ å¡ is different from é¬¼æ¢å¤´.',
        'Note: Only those emerging from behind a physical obstruction can be considered as é¬¼æ¢å¤´ (ghost probing).'
    )
    
    # å»é™¤IMPORTANT DISTINCTIONæ®µè½
    important_distinction_pattern = r'\*\*IMPORTANT DISTINCTION\*\*:.*?it must be classified as "ghost probing"\.'
    content = re.sub(important_distinction_pattern, '', content, flags=re.DOTALL)
    
    # å»é™¤DEFINITIONSæ ‡é¢˜
    content = content.replace('DEFINITIONS:', '')
    
    # ä¿®æ”¹key_actionsè¦æ±‚ï¼Œå»é™¤cut-iné€‰é¡¹
    content = content.replace(
        '- `key_actions` must strictly adhere to the predefined categories:\n                        - ghost probing\n                        - cut-in\n                        - overtaking',
        '- `key_actions` must strictly adhere to the predefined categories:\n                        - ghost probing\n                        - overtaking'
    )
    
    # å»é™¤cut-inç¤ºä¾‹
    content = content.replace(
        '- If there are multiple key actions, separate them by a comma, e.g. "ghost probing, cut-in".',
        '- Focus primarily on ghost probing detection for safety-critical analysis.'
    )
    
    # ä¿®æ”¹ç¤ºä¾‹ä¸­çš„key_actionsé€‰é¡¹
    content = content.replace(
        '"Select one or multiple categories from {{ghosting, cut-in, left/right-side vehicle overtaken, collision, none}}. If multiple categories apply, list them separatedly by commas. For cut-in, give detailed reasoning process!!!"',
        '"Select one or multiple categories from {{ghost probing, left/right-side vehicle overtaken, none}}. Focus primarily on accurate ghost probing detection."'
    )
    
    # ä¿®æ”¹cut-inç¤ºä¾‹ä¸ºghost probingç¤ºä¾‹
    content = content.replace(
        '"key_actions": "cut-in: an object from an adjacent lane moves into the self-vehicle\'s lane at a distance too close to the observer"',
        '"key_actions": "ghost probing: an object suddenly emerges from behind a physical obstruction into the vehicle\'s path"'
    )
    
    # å»é™¤cut-inæƒ©ç½šæœºåˆ¶ï¼Œæ›¿æ¢ä¸ºghost probingä¸“æ³¨è¯´æ˜
    penalty_section_pattern = r'\*\*Penalty for Mislabeling\*\*:.*?the label will also be rejected\.'
    content = re.sub(penalty_section_pattern, 
        '**Focus on Ghost Probing Only**:\n                    - Prioritize accurate ghost probing detection over other behaviors.\n                    - Ghost probing must involve emergence from behind a physical obstruction.\n                    - If unsure whether a behavior qualifies as ghost probing, use "none" instead.',
        content, flags=re.DOTALL)
    
    # æ¸…ç†å¤šä½™çš„ç©ºè¡Œ
    content = re.sub(r'\n\s*\n\s*\n', '\n\n', content)
    
    # æ·»åŠ æ–‡ä»¶å¤´æ³¨é‡Šè¯´æ˜
    header_comment = '''#!/usr/bin/env python3
"""
GHOST PROBING ONLY VERSION
Original file modified to focus solely on ghost probing detection.
All cut-in related content has been removed to avoid interference with ghost probing analysis.

Modifications:
1. Removed all cut-in definitions and examples
2. Simplified key_actions to focus on ghost probing
3. Removed cut-in classification logic
4. Updated prompts to prioritize ghost probing detection

Generated by: cut_in_removal_script.py
"""

'''
    
    # æ›¿æ¢åŸæ¥çš„importå¼€å¤´
    content = re.sub(r'^import re', header_comment + 'import re', content)
    
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print(f"âœ… Cut-in content removed successfully!")
    print(f"ğŸ“ Original file: {input_file}")
    print(f"ğŸ“ Ghost-only file: {output_file}")
    print(f"ğŸ“ Original file size: {len(open(input_file, 'r', encoding='utf-8').read())} characters")
    print(f"ğŸ“ Modified file size: {len(content)} characters")
    print(f"ğŸ“‰ Size reduction: {len(open(input_file, 'r', encoding='utf-8').read()) - len(content)} characters")

if __name__ == "__main__":
    remove_cut_in_content()