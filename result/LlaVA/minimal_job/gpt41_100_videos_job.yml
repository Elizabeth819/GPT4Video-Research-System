# GPT-4.1å¹³è¡¡ç‰ˆ100è§†é¢‘é¬¼æ¢å¤´æ£€æµ‹ä½œä¸š
$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command

# Job metadata
display_name: gpt41-balanced-100-videos-ghost-detection
description: "GPT-4.1 Balanced Ghost Probing Detection for 100 DADA videos (images_1_001 to images_5_xxx)"

# Compute configuration  
compute: azureml:llava-a100-low-priority
environment: azureml:AzureML-ACPT-pytorch-1.13-py38-cuda11.7-gpu:10

# Resource requirements
resources:
  instance_count: 1

# Code source
code: .

# GPT-4.1 100è§†é¢‘æ£€æµ‹ä½œä¸š
command: >
  echo "ğŸš€ å¼€å§‹GPT-4.1å¹³è¡¡ç‰ˆ100è§†é¢‘é¬¼æ¢å¤´æ£€æµ‹ä½œä¸š" &&
  python --version &&
  echo "ğŸ“‹ æ£€æŸ¥GPUå’ŒCUDAç¯å¢ƒ..." &&
  nvidia-smi &&
  python -c "import torch; print(f'PyTorch: {torch.__version__}'); print(f'CUDAå¯ç”¨: {torch.cuda.is_available()}')" &&
  echo "ğŸ”§ å®‰è£…ä¾èµ–åŒ…..." &&
  pip install opencv-python requests Pillow numpy &&
  echo "ğŸ“ æ£€æŸ¥è¾“å…¥æ•°æ®è·¯å¾„..." &&
  env | grep AZUREML_DATAREFERENCE_video_data &&
  echo "ğŸ“Š ç»Ÿè®¡è§†é¢‘æ–‡ä»¶..." &&
  find $AZUREML_DATAREFERENCE_video_data -name "images_[1-5]_*.avi" | wc -l &&
  echo "ğŸ” è¿è¡ŒGPT-4.1å¹³è¡¡ç‰ˆ100è§†é¢‘æ£€æµ‹..." &&
  timeout 21600 python gpt41_balanced_100_videos.py &&
  echo "ğŸ“Š æ£€æŸ¥è¾“å‡ºç»“æœ..." &&
  ls -la ./outputs/results/ &&
  echo "âœ… GPT-4.1 100è§†é¢‘æ£€æµ‹ä½œä¸šå®Œæˆ"

# Input data  
inputs:
  video_data:
    type: uri_folder
    path: azureml:dada-100-videos-fixed:1
    mode: ro_mount

# Output data
outputs:
  results:
    type: uri_folder
    mode: rw_mount

# Environment variables - Azure OpenAIé…ç½®
environment_variables:
  CUDA_VISIBLE_DEVICES: "0"
  # Azure OpenAI Visioné…ç½® (è¯·åœ¨æäº¤å‰è®¾ç½®å®é™…å€¼)
  AZURE_VISION_KEY: "your-azure-openai-key-here"
  VISION_ENDPOINT: "https://your-resource.openai.azure.com/"
  VISION_DEPLOYMENT_NAME: "gpt-4o-vision"
  
  # APIé…ç½®
  VISION_API_TYPE: "Azure"
  API_VERSION: "2024-02-15-preview"
  
  # å¤„ç†é…ç½®  
  FRAME_INTERVAL: "10"
  FRAMES_PER_INTERVAL: "10"
  MAX_TOKENS: "2000"
  TEMPERATURE: "0.3"

# Experiment settings
experiment_name: gpt41-balanced-100-videos-experiment