# æ¸…ç†åçš„LLaVAé¬¼æ¢å¤´æ£€æµ‹ä½œä¸š
$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command

# Job metadata
display_name: clean-llava-ghost-probing
description: "Clean LLaVA Ghost Probing Detection on 100 DADA Videos"

# Compute configuration
compute: azureml:llava-a100-low-priority
environment: azureml:AzureML-ACPT-pytorch-1.13-py38-cuda11.7-gpu:10

# Resource requirements
resources:
  instance_count: 1

# Code source
code: .

# Fixed command with proper Python script
command: >
  echo "ğŸš€ å¼€å§‹LLaVAé¬¼æ¢å¤´æ£€æµ‹ä½œä¸š" &&
  python --version &&
  pip list | grep -E "(torch|numpy)" &&
  echo "ğŸ“ æ£€æŸ¥è¾“å…¥æ•°æ®è·¯å¾„..." &&
  echo "å½“å‰å·¥ä½œç›®å½•:" &&
  pwd &&
  echo "æŸ¥æ‰¾æ‰€æœ‰inputsç›®å½•:" &&
  find . -name "*video*" -type d 2>/dev/null &&
  echo "æ£€æŸ¥inputsç›®å½•ç»“æ„:" &&
  ls -la ./inputs/ || echo "inputsç›®å½•ä¸å­˜åœ¨" &&
  echo "æ£€æŸ¥video_dataç›®å½•:" &&
  ls -la ./inputs/video_data/ 2>/dev/null | head -10 || echo "video_dataç›®å½•ä¸å­˜åœ¨ï¼Œå°è¯•å…¶ä»–è·¯å¾„" &&
  echo "æœç´¢.aviæ–‡ä»¶:" &&
  find ./inputs -name "*.avi" 2>/dev/null | head -5 || echo "æœªæ‰¾åˆ°.aviæ–‡ä»¶" &&
  echo "ğŸ“Š è¿è¡Œæ£€æµ‹è„šæœ¬..." &&
  python detect_ghost.py &&
  echo "âœ… LLaVAé¬¼æ¢å¤´æ£€æµ‹ä½œä¸šå®Œæˆ"

# Input data  
inputs:
  video_data:
    type: uri_folder
    path: azureml:dada-100-videos-fixed:1
    mode: ro_mount

# Output data
outputs:
  results:
    type: uri_folder
    mode: rw_mount

# Experiment settings
experiment_name: clean-llava-experiment